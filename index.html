<!DOCTYPE html>
<html>
  <head>
    <title>Canvas Example</title>
    <meta content='text/html;charset=utf-8' http-equiv='Content-Type'>
    <link href='https://cdnjs.cloudflare.com/ajax/libs/normalize/3.0.3/normalize.css' rel='stylesheet' type='text/css'>
    <script src='https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js' type='text/javascript'></script>
    <style>
      body {
        font-size: 14px;
        margin: 10px; }
        body button {
          background: none;
          border: 1px solid #ddd;
          width: 150px;
          display: block; }
          body button:hover {
            background-color: #f8f8f8; }
          body button + button {
            margin-top: 5px; }
        body #board {
          float: left;
          width: 500px;
          height: 500px;
          position: relative;
          margin-right: 10px; }
          body #board #grid {
            position: absolute;
            top: 0;
            left: 0; }
          body #board #main-canvas {
            position: relative;
            z-index: 10;
            cursor: pointer; }
        body #tips {
          color: #999;
          list-style: none; }
    </style>
    <script>
      (function() {
        var Board, Grid,
          bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };
      
        Grid = (function() {
          function Grid(context) {
            this.context = context;
          }
      
          Grid.prototype.initGrid = function() {
            var i, j, x, y;
            for (x = i = 0; i <= 50; x = ++i) {
              this.context.moveTo(x * 10 + 0.5, 0);
              this.context.lineTo(x * 10 + 0.5, 500);
            }
            for (y = j = 0; j <= 50; y = ++j) {
              this.context.moveTo(0, y * 10 + 0.5);
              this.context.lineTo(500, y * 10 + 0.5);
            }
            this.context.strokeStyle = '#ddd';
            return this.context.stroke();
          };
      
          return Grid;
      
        })();
      
        Board = (function() {
          function Board(context) {
            this.context = context;
            this.tick = bind(this.tick, this);
            this.cells = this.initBoard();
          }
      
          Board.prototype.initBoard = function() {
            var i, results, x, y;
            results = [];
            for (x = i = 0; i <= 49; x = ++i) {
              results.push((function() {
                var j, results1;
                results1 = [];
                for (y = j = 0; j <= 49; y = ++j) {
                  results1.push(false);
                }
                return results1;
              })());
            }
            return results;
          };
      
          Board.prototype.start = function() {
            return this.interval = setInterval(this.tick, 100);
          };
      
          Board.prototype.stop = function() {
            if (this.interval != null) {
              return clearInterval(this.interval);
            }
          };
      
          Board.prototype.reset = function() {
            this.stop();
            this.clearAll();
            return this.cells = this.initBoard();
          };
      
          Board.prototype.tick = function() {
            var alive, aliveNeighbours, cells, i, j, k, len, neighbour, ref, row, x, y;
            this.clearAll();
            cells = [];
            for (x = i = 0; i <= 49; x = ++i) {
              row = [];
              for (y = j = 0; j <= 49; y = ++j) {
                aliveNeighbours = 0;
                ref = this.neighbourCoordFor(x, y);
                for (k = 0, len = ref.length; k < len; k++) {
                  neighbour = ref[k];
                  if (this.cells[neighbour.x][neighbour.y]) {
                    aliveNeighbours += 1;
                  }
                }
                alive = (this.cells[x][y] && aliveNeighbours === 2) || aliveNeighbours === 3;
                if (alive) {
                  this.draw(x, y);
                }
                row.push(alive);
              }
              cells.push(row);
            }
            return this.cells = cells;
          };
      
          Board.prototype.addCell = function(x, y) {
            this.cells[x][y] = true;
            return this.draw(x, y);
          };
      
          Board.prototype.removeCell = function(x, y) {
            this.cells[x][y] = false;
            return this.clear(x, y);
          };
      
          Board.prototype.neighbourCoordFor = function(x, y) {
            var downY, leftX, rightX, upY;
            leftX = x === 0 ? 49 : x - 1;
            rightX = x === 49 ? 0 : x + 1;
            upY = y === 0 ? 49 : y - 1;
            downY = y === 49 ? 0 : y + 1;
            return [
              {
                x: leftX,
                y: upY
              }, {
                x: x,
                y: upY
              }, {
                x: rightX,
                y: upY
              }, {
                x: leftX,
                y: y
              }, {
                x: rightX,
                y: y
              }, {
                x: leftX,
                y: downY
              }, {
                x: x,
                y: downY
              }, {
                x: rightX,
                y: downY
              }
            ];
          };
      
          Board.prototype.clearAll = function() {
            return this.context.clearRect(0, 0, 500, 500);
          };
      
          Board.prototype.draw = function(x, y) {
            return this.context.fillRect(x * 10, y * 10, 10, 10);
          };
      
          Board.prototype.clear = function(x, y) {
            return this.context.clearRect(x * 10, y * 10, 10, 10);
          };
      
          return Board;
      
        })();
      
        $(function() {
          var $mainCanvas;
          new Grid($('#grid')[0].getContext('2d')).initGrid();
          $mainCanvas = $('#main-canvas');
          $mainCanvas.data('board', new Board($mainCanvas[0].getContext('2d')));
          $('[data-game-action]').on('click', function() {
            var action;
            action = $(this).data('game-action');
            return $mainCanvas.data('board')[action]();
          });
          return $mainCanvas.on('contextmenu', function(e) {
            return false;
          }).on('mousedown', function(e) {
            var board, x, y;
            x = Math.floor(e.offsetX / 10.0);
            y = Math.floor(e.offsetY / 10.0);
            board = $(this).data('board');
            if (e.which === 1) {
              return board.addCell(x, y);
            } else {
              return board.removeCell(x, y);
            }
          });
        });
      
      }).call(this);
    </script>
  </head>
  <body>
    <div id='board'>
      <canvas height='500' id='main-canvas' width='500'></canvas>
      <canvas height='501' id='grid' width='501'></canvas>
    </div>
    <button data-game-action='start' type='button'>
      Start
    </button>
    <button data-game-action='stop' type='button'>
      Stop
    </button>
    <button data-game-action='reset' type='button'>
      Reset
    </button>
    <ul id='tips'>
      <li>Click to add cell</li>
      <li>Right click to remove cell</li>
    </ul>
  </body>
</html>
